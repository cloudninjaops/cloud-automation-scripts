# ============================================================
# SNS YAML 
# - Standard + FIFO topics supported
# - KMS is mandatory
# - logging enabled
# - Subscriptions supported: email, sms, http, https
# - SQS excluded for now
# ============================================================

sns:
  <topic_id_1>:
    source: "<source>"
    destination: "<destination>"
    application: "<application>"
    function: "<function>"
    software: "<software>"
    kms_key: "<kms_key_name>"     # e.g., "key_1"

    # -----------------------------
    # Topic type
    # -----------------------------
    fifo_topic: false             # true | false. For Standard SNS topic set to false

    # -----------------------------
    # Topic properties (optional)
    # -----------------------------
    topic_props:
      display_name: "<display_name>"   # optional;

      # FIFO-only props (only apply when fifo_topic: true)
      fifo_props:
        content_based_deduplication: true
        deduplication_scope: "topic"       # topic | messageGroup
        fifo_throughput_limit: "perTopic"  # perTopic | perMessageGroupId

      # Delivery policy (topic-level;  for http/https)
      delivery_policy:
        http:
          defaultHealthyRetryPolicy:
            minDelayTarget: 20
            maxDelayTarget: 20
            numRetries: 3
            numMaxDelayRetries: 0
            numNoDelayRetries: 0
            numMinDelayRetries: 0
            backoffFunction: "linear"
          disableSubscriptionOverrides: false
          defaultThrottlePolicy:
            maxReceivesPerSecond: 1

      #  logging controls (SNS delivery status logging)
      delivery_status_logging:
        enabled: true
        protocols:
          sms: true
          http: true
          https: true
        success_sample_rate: 100

    # -----------------------------
    # Subscriptions (no duplicates)
    # Supported protocols:
    # - email
    # - sms
    # - http
    # - https
    # -----------------------------
    subscriptions:
      - protocol: "email"
        endpoint: "alerts@example.com"
        props: ## optional
          filter_policy:
            severity: ["CRITICAL", "HIGH"]

      - protocol: "email"
        endpoint: "oncall@example.com"

      - protocol: "sms"
        endpoint: "+12223334444"
        props: ## optional
          filter_policy:
            severity: ["CRITICAL"]

      - protocol: "https"
        endpoint: "https://hooks.example.com/sns"
        props: ## optional
          endpoint_auto_confirms: true # set it to true.  true: Terraform does NOT wait for confoirmation. false: terraform waits for conformation
          filter_policy:
            eventType: ["ALERT"]
